## EC2 (Amazon Elastic Compute Cloud)

Amazon services that allows "rent" custom machines to run services.

- There are machine types, such as, t2.micro or t2.large;
- There are images too: wordpress, MySQL, Windows Server...

### How to Connect and use it

Pretty easy, SSH or even a web terminal. Interesting using a certified generated by AWS to connect in the machine.

Example: `ssh -i "your-file.pem" machine-user@machine-ip-dns`

### Security Group

The instances are created in the same VPC (Virtual Private Cloud), however, the ports and type of access need to be allowed/configured.

The Security Group is responsible by these configurations.

It is possible create many group as need and each team can define how the instances are gonna be configurate. A good idea is create generic configurations, such as, ssh-access and web-access, because provides a better flexibility.

Security Group works like a firewall police, allowing or not the access.

### Ips

The instance IP is dynamic by default, but It is possible set a static IP to an instance. Just go to Elastic IPs and configure.

Important check the pricing table, because depending of the configuration, there will be fees involved.

1 IP per running instance (DO NOT stop it haha) there is no charge.

### Images

Similar to docker, It is possible create images to improve the speed and standardization.

Important stop the instance used as model to the image, avoiding malformed images.

### Auto Scaling and Elastic Load Balance

Basic Concept:

![Example](https://github.com/antonioChristofoletti/course-alura-aws/blob/master/01_ec2_scalability_disponibility/images.md/concept_load_balance_auto_scalling.png)

Ultra simplified concepts:

- Amazon EC2 Auto Scaling: Configuration that makes sure the running quantity of instance is right and proper, giving a certain scenario, being possible decreases or increases the number depending of the configuration. Also It can detect if an instance is not running and create new ones, the params for this is also custom.
    - Launch Configuration: template of the instances, set the AMI, key pair access and so on..
    - Auto Scaling Groups: Collection of instance itself and rules, such as, how many instances (min/max) and health check params. The instance basics configuration comes from a Launch Configuration.

- Load Balancers: Common concept, In the AWS It will be a machine that will handle the requests. Since It will be a machine (instance), there may be fees associated to the load balancer too.
    - Target Groups: Group of machine that will be part of the balance process. A Load Balance may have many Target Groups, in which will be used for different rules and or a specific listiner. It is up to the software context define these configurations.

The big point is join the Auto Scaling and Load Balancer, so a Target Group would be fed by an Auto Scallng Group, increasing a lot the flexibility, confiablity and scalability of the software demands.

Cool Link:

- https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html.

### General Tips

- It is a good idea keep the Terminate Protection activated in order to avoid delete the machine.
- Instance has the following status: running, stopped, reboot and terminate.
- It is possible provide the instance during the creation. Configure Instance -> Advanced Details -> User data.

Script example:

```
#!/bin/bash
#Atualizando os pacotes
yum update -y
#Configurando os repositórios
amazon-linux-extras install -y lamp-mariadb10.2-php7.2 php7.2
#Instalando o apache e o mysql
yum install -y httpd mariadb-server
#inicialização automática
systemctl start httpd
systemctl enable httpd
systemctl start mariadb
systemctl enable mariadb
#Ajustando o permissionamento
usermod -a -G apache ec2-user
chown -R ec2-user:apache /var/www
```

### AWS CLI

Command line tool in order to manage AWS resources.

It allows creates user with differents access.

Some commands:
 - `aws ec2 start-instances --instance-ids ID_INSTANCE`;
 - `aws ec2 describe-instances`.


 Obs.: The CLI just gonna show instances from the configured region. It is possible to change or define a specific region for the search.

### Amazon RDS(Amazon Relational Database Service)

It is an other service. It is interesting using this option, because It manages the database as a service, so AWS will take care of all the boring stuff related to database.

It is not possible connect on the database machine, just in the database itself, because It is a service.

Even being an instance, It is not possible manage it, just the database through a endpoint.

Connection example:

` mysql -u user -h database-endpoint -p`

### Cool Links

- Price estimator - https://calculator.aws/#/;
